"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[926],{1926:function(e,t,r){r.d(t,{Z:function(){return y}});var a=r(7437),s=r(2265);let n=e=>Promise.resolve(e.reduce((e,t)=>(e[t]=t,e),{})),i=e=>Promise.resolve(e),o=e=>Promise.resolve(e()),l=e=>e(),c={isSelected:!1,tag:"li"};var u=e=>{let{key:t,value:r,label:n,isSelected:i,tag:o,onSelect:l}={...c,...e};return s.createElement(o,{key:t},(0,a.jsxs)("div",{className:"flex flex-row block pl-2 pr-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-600 dark:hover:text-white",onClick:()=>l(r,n),children:[i?(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor","aria-hidden":"true",className:"min-w-5 w-5 h-5 mr-2",children:(0,a.jsx)("path",{"fill-rule":"evenodd",d:"M16.704 4.153a.75.75 0 01.143 1.052l-8 10.5a.75.75 0 01-1.127.075l-4.5-4.5a.75.75 0 011.06-1.06l3.894 3.893 7.48-9.817a.75.75 0 011.05-.143z","clip-rule":"evenodd"})}):(0,a.jsx)("span",{className:"min-w-7 inline-block"}),n]}))};let d={ul:"li",ol:"li",div:"div"},g={isOpen:!1,items:{},value:"",tag:"ul",onSelect:(e,t)=>()=>console.log("Selected:",e,t)};var f=e=>{let{isOpen:t,items:r,value:n,tag:i,onSelect:o}={...g,...e};return t?(0,a.jsx)("div",{className:"absolute top-2 left-0 right-0 z-10 overflow-y-auto max-h-96 bg-white divide-y divide-gray-100 rounded-lg shadow w-100 dark:bg-gray-700",children:s.createElement(i,{className:"py-2 text-sm text-gray-700 dark:text-gray-200"},Object.entries(r).sort((e,t)=>{let[,r]=e,[,a]=t;return r.toString().localeCompare(a.toString())}).map(e=>{let[t,r]=e;return(0,a.jsx)(u,{value:t,label:r,isSelected:t===n,tag:d[i],onSelect:o},t)}))}):(0,a.jsx)(a.Fragment,{})};let h={placeholder:"",value:"",setValue:()=>{}};var p=e=>{let{data:t,placeholder:r,value:c,setValue:u}={...h,...e},[d,g]=(0,s.useState)({}),[p,m]=(0,s.useState)({}),[b,w]=(0,s.useState)(c),[k,x]=(0,s.useState)(!1),y=(0,s.useCallback)((e,t)=>{u(e),w(t),x(!1)},[u]);return(0,s.useEffect)(()=>{t&&(function(e){if(Array.isArray(e))return n(e);if("object"==typeof e)return i(e);if("function"==typeof e)return 0===e.length?o(e):l(e);throw Error("Invalid data type")})(t).then(e=>{g(e),m(e),c&&w(e[c]||"")})},[t,c]),(0,s.useEffect)(()=>{if(!b||b===d[c]){m(d);return}m(Object.fromEntries(Object.entries(d).filter(e=>{let[t,r]=e;return r.toLowerCase().includes(b.toLowerCase())||t===c})))},[b,d,c]),(0,a.jsxs)("div",{className:"flex flex-col",children:[(0,a.jsx)("input",{type:"text",value:b,placeholder:r,className:"block py-2.5 px-0 w-full text-sm text-gray-900 bg-transparent border-0 border-b-2 border-gray-300 appearance-none dark:text-white dark:border-gray-600 dark:focus:border-blue-500 focus:outline-none focus:ring-0 focus:border-blue-600 peer",onChange:e=>w(e.target.value),onFocus:()=>x(!0),onBlur:()=>setTimeout(()=>{x(!1)},400)}),(0,a.jsx)("div",{className:"relative",children:(0,a.jsx)(f,{isOpen:k,items:p,value:c,onSelect:y})})]})},m=r(4124),b=r(8433),w=r(1169),k=r(7138),x=e=>{let{stop:t,removeStop:r,onChange:s}=e;return(0,a.jsxs)("div",{className:"w-full bg-white p-4 mb-4 border border-gray-200 rounded-lg shadow dark:bg-gray-800 dark:border-gray-700",children:[(0,a.jsxs)("div",{className:"flex flex-row justify-between",children:[(0,a.jsxs)("h4",{className:"mb-4 mr-4",children:[t.name," (",t.number,")"]}),(0,a.jsx)("button",{type:"button",className:"p-2 text-sm font-medium text-gray-900 bg-white rounded-lg hover:bg-gray-100 hover:text-blue-700 focus:z-10 focus:ring-2 focus:ring-blue-700 focus:text-blue-700 dark:bg-gray-800 dark:border-gray-700 dark:text-white dark:hover:text-white dark:hover:bg-gray-700 dark:focus:ring-blue-500 dark:focus:text-white",onClick:()=>r(t),children:(0,a.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"w-5 h-5 min-w-5 min-h-5",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M6 18 18 6M6 6l12 12"})})})]}),Object.entries(t.direction_desc).map(e=>{let[r,n]=e,i="".concat(t.number,"_").concat(r);return(0,a.jsxs)("div",{className:"flex items-center mb-3",children:[(0,a.jsx)("input",{id:i,type:"checkbox",checked:t.lines.includes(r),value:r,onChange:e=>s(t.number,r,e.target.checked),className:"w-4 h-4 text-blue-600 bg-gray-100 border-gray-300 rounded focus:ring-blue-500 dark:focus:ring-blue-600 dark:ring-offset-gray-800 focus:ring-2 dark:bg-gray-700 dark:border-gray-600"}),(0,a.jsxs)("label",{htmlFor:i,className:"ms-2 text-sm font-medium text-gray-900 dark:text-gray-300",children:[r," (",n,")"]})]},i)})]})};function y(e){let{profile:t,uuid:r}=e,n=(0,w.useRouter)(),[i,o]=(0,s.useState)(t.name),[l,c]=(0,s.useState)(""),[u,d]=(0,s.useState)([]),[g,f]=(0,s.useState)(t.stops||[]);(0,s.useEffect)(()=>{m.Z.instance.getStopsForSelect().then(d)},[]);let h=(0,s.useCallback)(()=>{l&&!(g.filter(e=>e.number===l).length>0)&&m.Z.instance.getStopById(l).then(e=>e&&f(t=>[e,...t]))},[l,g]),y=(0,s.useCallback)(()=>{let e=b.Z.instance,t="new"===r,a=t?e.createProfile(i,g):e.getProfile(r);a&&(t?e.getConfig().currentProfile=a.uuid:(a.name=i,a.stops=g),e.saveConfig(),n.push("/config/edit"))},[i,g,r,n]),v=(0,s.useCallback)(e=>{f(t=>t.filter(t=>t.number!==e.number))},[]),j=(0,s.useCallback)((e,t,r)=>{f(a=>a.map(a=>a.number===e?{...a,lines:r?[...a.lines,t]:a.lines.filter(e=>e!==t)}:a))},[]);return(0,a.jsxs)("form",{className:"min-w-full mx-auto",onSubmit:e=>{e.preventDefault(),y()},children:[(0,a.jsxs)("div",{className:"relative w-full mb-5 group",children:[(0,a.jsx)("input",{type:"text",id:"profile_name",className:"block py-2.5 px-0 w-full text-sm text-gray-900 bg-transparent border-0 border-b-2 border-gray-300 appearance-none dark:text-white dark:border-gray-600 dark:focus:border-blue-500 focus:outline-none focus:ring-0 focus:border-blue-600 peer",placeholder:" ",value:i,onChange:e=>o(e.target.value),required:!0}),(0,a.jsx)("label",{htmlFor:"profile_name",className:"peer-focus:font-medium absolute text-sm text-gray-500 dark:text-gray-400 duration-300 transform -translate-y-6 scale-75 top-3 -z-10 origin-[0] peer-focus:start-0 rtl:peer-focus:translate-x-1/4 rtl:peer-focus:left-auto peer-focus:text-blue-600 peer-focus:dark:text-blue-500 peer-placeholder-shown:scale-100 peer-placeholder-shown:translate-y-0 peer-focus:scale-75 peer-focus:-translate-y-6",children:"Nazwa profilu"})]}),(0,a.jsx)("div",{className:"relative w-full mb-5 group",children:(0,a.jsxs)("div",{className:"flex flex-row",children:[(0,a.jsxs)("div",{className:"grow mr-2",children:[(0,a.jsx)("label",{htmlFor:"stop_to_add",className:"sr-only",children:"Przystanek"}),(0,a.jsx)(p,{data:u,value:l,setValue:e=>{c(e)}})]}),(0,a.jsx)("button",{type:"button",className:"p-2 text-sm font-medium text-gray-900 bg-white border border-gray-200 rounded-lg hover:bg-gray-100 hover:text-blue-700 focus:z-10 focus:ring-2 focus:ring-blue-700 focus:text-blue-700 dark:bg-gray-800 dark:border-gray-700 dark:text-white dark:hover:text-white dark:hover:bg-gray-700 dark:focus:ring-blue-500 dark:focus:text-white",onClick:h,children:(0,a.jsxs)("svg",{className:"h-5 w-5",width:"24",height:"24",viewBox:"0 0 24 24",strokeWidth:"2",stroke:"currentColor",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,a.jsx)("path",{stroke:"none",d:"M0 0h24v24H0z"}),(0,a.jsx)("line",{x1:"12",y1:"5",x2:"12",y2:"19"}),(0,a.jsx)("line",{x1:"5",y1:"12",x2:"19",y2:"12"})]})})]})}),(0,a.jsx)("div",{className:"relative w-full mb-5 group",children:(0,a.jsx)("ul",{children:g.map(e=>(0,a.jsx)("li",{children:(0,a.jsx)(x,{stop:e,removeStop:v,onChange:j})},e.number))})}),(0,a.jsxs)("div",{className:"w-full flex flex-row justify-between mt-6 pt-6 border-t border-slate-700",children:[(0,a.jsx)(k.default,{href:"/",children:"Wr\xf3ć"}),(0,a.jsx)("button",{type:"submit",className:"text-white bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-lg text-sm w-auto px-5 py-2.5 text-center dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800",children:"Zapisz"})]})]})}},8433:function(e,t,r){r.d(t,{Z:function(){return i}});let a={profiles:[{uuid:"07ab72c4-183a-4e6c-ad98-32bd63086730",name:"Do szkoły",stops:[{id:41997,name:"Waryńskiego - Kolejowa",street:"Waryńskiego",latitude:"49.6054",longitude:"20.6954",number:"00171",direction:0,stop_line_id:113776,lines:["9","11","13","17","18","24","43","47","49","52"],direction_desc:{9:"Bohater\xf3w Orła Białego => Rynek",11:"Przysietnica => Rynek.",13:"Konarskiego => Konarskiego",17:"Jana Pawła II => Barska",18:"Żeleźnikowa Wielka => Roszkowice",24:"Stary Sącz - Osiedle Słoneczne => Rynek",43:"Moszczenica => Rynek",47:"",49:"",52:""}},{id:41484,name:"Grottgera - Zielona",street:null,latitude:"49.6023",longitude:"20.6945",number:"02272",direction:1,stop_line_id:114203,lines:["17"],direction_desc:{17:"Jana Pawła II => Barska"}},{id:41614,name:"Zielona - WSB",street:"Zielona ",latitude:"49.6009",longitude:"20.6921",number:"00961",direction:1,stop_line_id:114202,lines:["17","27"],direction_desc:{17:"Jana Pawła II => Barska",27:"Piątkowa Łęg Granica => Dw.MPK. "}}]},{uuid:"41a65a08-dca8-401e-b7a8-129832cee211",name:"Ze szkoły",stops:[{id:42230,name:"Rynek",street:"Rynek",latitude:"49.6255",longitude:"20.6918",number:"00081",direction:1,stop_line_id:113693,lines:["14","15","17","27","41","25"],direction_desc:{5:"Dw.MPK stan.1 => Tarnowska",7:"Sucharskiego => Sucharskiego",14:"Wola Wyżna => Dw.MPK",15:"Mszalnica => Dw.MPK",17:" Barska => Jana Pawła II",18:"Żeleźnikowa Wielka => Roszkowice",25:"Mystk\xf3w Most => Ogrodowa",27:"Piątkowa Łęg Granica => Dw.MPK. ",28:"Węgierska Galeria Sandecja => Roszkowice",31:"Dw.MPK stan.1 => Zabełcze - Gaj",35:"Jamnica => Rynek",41:"Osiedle Helena => Magazynowa",42:" Dw.MPK stan.1 => Osiedle Helena",101:"Stramki => Prażmowskiego."}}]},{uuid:"f59583cd-7339-4ffc-9371-0be2095ec036",name:"Basen",stops:[{id:42239,name:"Aleja Batorego - Dw. PKP",street:"Aleja Batorego",latitude:"49.6082",longitude:"20.7016",number:"00015",direction:1,stop_line_id:114343,lines:["23"],direction_desc:{23:"Sucharskiego => Sucharskiego",25:"Ogrodowa => Mystk\xf3w Most",27:"Piątkowa Łęg Granica => Dw.MPK. "}},{id:41997,name:"Waryńskiego - Kolejowa",street:"Waryńskiego",latitude:"49.6054",longitude:"20.6954",number:"00171",direction:0,stop_line_id:113776,lines:["9","11","13","17","18","24","43","47","49","52"],direction_desc:{9:"Bohater\xf3w Orła Białego => Rynek",11:"Przysietnica => Rynek.",13:"Konarskiego => Konarskiego",17:"Jana Pawła II => Barska",18:"Żeleźnikowa Wielka => Roszkowice",24:"Stary Sącz - Osiedle Słoneczne => Rynek",43:"Moszczenica => Rynek",47:"",49:"",52:""}}]}],currentProfile:"f59583cd-7339-4ffc-9371-0be2095ec036"};var s,n=r(920);class i{static get instance(){return i._instance||(i._instance=new i),i._instance}static set storage(e){i._storage=e}getConfig(){return this.config}saveConfig(){var e;null===(e=i._storage)||void 0===e||e.setItem(i.storageKey,JSON.stringify(this.config))}getProfile(e){return this.config.profiles.find(t=>t.uuid===e)}getCurrentProfile(){return this.getProfile(this.config.currentProfile)}removeCurrentProfile(){this.config.profiles.splice(this.config.profiles.findIndex(e=>e.uuid===this.config.currentProfile),1),this.config.currentProfile=this.config.profiles[0].uuid,this.saveConfig()}createProfile(e,t){let r={uuid:i.generateUuid(),name:e,stops:t};return this.config.profiles.push(r),r}static generateUuid(){return(0,n.Z)()}constructor(){var e;let t=(null===(e=i._storage)||void 0===e?void 0:e.getItem(i.storageKey))||null;this.config=null===t?a:JSON.parse(t)}}i._storage=null===(s=r.g)||void 0===s?void 0:s.localStorage,i.storageKey="ns_mpk_board_config"},4124:function(e,t,r){r.d(t,{Z:function(){return i}});class a{async fetchData(){let e=await fetch(this.url);this.data=await e.json()}async getData(){return null===this.data&&await this.fetchData(),this.data}constructor(e){this.url=e,this.data=null}}class s extends a{async getDepartures(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];let a=await this.getData(),s=new Date().getTime();return a.st.filter(e=>t.includes(e.nr)).reduce((e,t)=>{var r;return null===(r=t.sd)||void 0===r||r.forEach(r=>{e.push({name:t.nm,number:t.nr,direction:r.di,line:r.li,departure:r.de,timeToDeparture:this.timeToDeparture(s,r.de)})}),e},[]).sort((e,t)=>e.timeToDeparture-t.timeToDeparture)}async getFreshDepartures(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return await this.fetchData(),this.getDepartures(...t)}timeToDeparture(e,t){if(">>"===t)return e;if(t.match(/^\d+min/))return e+6e4*parseInt(t);if(!t.match(/^\d+:\d+$/))return e;{let[r,a]=t.split(":").map(e=>parseInt(e)),s=new Date(e);return s.setHours(r),s.setMinutes(a),s.getTime()}}constructor(){super(s.departuresUrl)}}s.departuresUrl="https://www.mpk.nowysacz.pl/jsonStops/stops.json";class n extends a{async getActiveLines(){return this.getData()}getLineStops(e){return[...e.stops,...e.stops1].map(t=>({...t,lines:[e.name],direction_desc:{[e.name]:e["desc".concat(t.direction?"1":"2")].replace(/^([^,]+).*?,\s*([^,]+)$/,"$1 => $2").replace(/^ => $/,"")}}))}async getStops(){if(0===this.stops.length){let e=await this.getData();this.stops=e.lines.reduce((e,t)=>(this.getLineStops(t).forEach(t=>{let r=e.find(e=>e.id===t.id);r?(r.lines=[...r.lines||[],...t.lines||[]],r.direction_desc={...r.direction_desc,...t.direction_desc}):e.push({...t})}),e),[]).sort((e,t)=>e.name.localeCompare(t.name))}return this.stops}constructor(){super(n.activeStopsUrl),this.stops=[]}}n.activeStopsUrl="https://www.mpk.nowysacz.pl/wp-json/mpk/v1/timetable/active";class i{static get instance(){return i._instance||(i._instance=new i),i._instance}async getStopsForSelect(e){let t=await this.stopsDataSource.getStops();return e&&(t=t.filter(t=>"".concat(t.name," ").concat(t.street).toLowerCase().includes(e.toLowerCase()))),t.reduce((e,t)=>{let r=[];for(let e in t.direction_desc)r.push("".concat(e).concat(t.direction_desc[e]?": "+t.direction_desc[e]:""));return e[t.number]="".concat(t.name," (").concat(r.join(", "),")"),e},{})}async getStopById(e){let t=(await this.stopsDataSource.getStops()).find(t=>t.number===e);return console.log(t),t}async getDepartures(){for(var e=arguments.length,t=Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.departuresDataSource.getFreshDepartures(...t)}constructor(){this.departuresDataSource=new s,this.stopsDataSource=new n}}}}]);